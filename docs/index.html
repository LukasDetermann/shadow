<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Shadow API</title>
<style>
@import url(//fonts.googleapis.com/css?family=Noto+Sans);

@import url(//fonts.googleapis.com/css?family=JetBrains+Mono);

@import url(https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css); /* Default asciidoc style framework - important */





body {

    font-family: "Noto Sans", sans-serif;

}



h1 {

    font-family: "Noto Sans", sans-serif;

}



h2, h3, h4, h5, h6 {

    color: black !important;

    font-family: "Noto Sans", sans-serif;

}



.title {

    font-family: "Noto Sans", sans-serif;

}



p {

    font-family: "Noto Sans", sans-serif ! important

}



code {

    font-family: "Noto Sans", "JetBrains Mono";

    padding: 6px;

    padding-left: 8px;

    background-color: var(--codebackground) !important

}





#toctitle {

    color: #4f5359;

}



@media all and (max-width: 600px) {

    table {

        width: 55vw !important;

        font-size: 3vw;

    }

}



a {

    color: black;

}



.literalblock pre, .listingblock > .content > pre {

    padding: 0px;

    background-color: #ebebeb !important

}


</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<style>
/*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
.tabs {
    margin-bottom: 1.25em;
}

.tablist > ul {
    display: flex;
    flex-wrap: wrap;
    list-style: none;
    margin: 0;
    padding: 0;
}

.tablist > ul li {
    align-items: center;
    background-color: #fff;
    cursor: pointer;
    display: flex;
    font-weight: bold;
    line-height: 1.5;
    padding: 0.25em 1em;
    position: relative;
}

.tablist > ul li:focus-visible {
    outline: none;
}

.tablist.ulist,
.tablist.ulist > ul li {
    margin: 0;
}

.tablist.ulist > ul li + li {
    margin-left: 0.25em;
}

.tabs .tablist li::after {
    content: "";
    display: block;
    height: 1px;
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
}

.tabs.is-loading .tablist li:not(:first-child),
.tabs:not(.is-loading) .tablist li:not(.is-selected) {
    background-color: #f5f5f5;
}

.tabs.is-loading .tablist li:first-child::after,
.tabs:not(.is-loading) .tablist li.is-selected::after {
    background-color: #fff;
}

/*
.tabs:not(.is-loading) .tablist li,
.tabs:not(.is-loading) .tablist li::after {
  transition: background-color 200ms ease-in-out;
}
*/

.tablist > ul p {
    line-height: inherit;
    margin: 0;
}

.tabpanel {
    background-color: #fff;
    padding: 1.25em;
}

.tablist > ul li,
.tabpanel {
    border: 1px solid #dcdcdc;
}

.tablist > ul li {
    border-bottom: 0;
}

.tabs.is-loading .tabpanel + .tabpanel,
.tabs:not(.is-loading) .tabpanel.is-hidden {
    display: none;
}

.tabpanel > :first-child {
    margin-top: 0;
}

/* #content is a signature of the Asciidoctor standalone HTML output */
#content .tabpanel > :last-child,
#content .tabpanel > :last-child > :last-child,
#content .tabpanel > :last-child > :last-child > li:last-child > :last-child {
    margin-bottom: 0;
}

.tablecontainer {
    overflow-x: auto;
}

#content .tablecontainer {
    margin-bottom: 1.25em;
}

#content .tablecontainer > table.tableblock {
    margin-bottom: 0;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Shadow API</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_modules">Modules</a></li>
<li><a href="#_annotation_processing">Annotation Processing</a>
<ul class="sectlevel2">
<li><a href="#_what_is_this">What is this?</a></li>
<li><a href="#_getting_started">Getting started</a></li>
<li><a href="#_setup">Setup</a></li>
</ul>
</li>
<li><a href="#_simple_builder_example">Simple Builder Example</a></li>
<li><a href="#_reflection">reflection</a>
<ul class="sectlevel2">
<li><a href="#_what_is_this_2">What is this?</a></li>
<li><a href="#_getting_started_2">Getting started</a></li>
</ul>
</li>
<li><a href="#_java_lang_model">java.lang.model</a>
<ul class="sectlevel2">
<li><a href="#_what_is_this_3">What is this?</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect2">
<h3 id="_modules">Modules</h3>
<div class="sect3">
<h4 id="_shadow_core">shadow-core</h4>
<div class="ulist">
<ul>
<li>
<p>Contains the core readonly Data-Structure</p>
</li>
<li>
<p>Converters to convert only in possible types. e.g. Executable &#8594; Method</p>
</li>
<li>
<p>Renderers to assist in creating Source-Files</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_shadow_lang_model">shadow-lang-model</h4>
<div class="ulist">
<ul>
<li>
<p>implementation of the shadow-core Data-Structure</p>
</li>
<li>
<p>Adapter for shadow-Data-Structure ⇄ java.lang.model</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_shadow_annotation_processing">shadow-annotation-processing</h4>
<div class="ulist">
<ul>
<li>
<p>extends shadow-lang-model</p>
</li>
<li>
<p>Adapter for shadow-Data-Structure ⇄ javax.annotation.processing</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_shadow_reflection">shadow-reflection</h4>
<div class="ulist">
<ul>
<li>
<p>implementation of the shadow-core Data-Structure</p>
</li>
<li>
<p>Adapter for shadow-Data-Structure ⇄ java.lang.reflect</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_shadow_consistency_test">shadow-consistency-test</h4>
<div class="ulist">
<ul>
<li>
<p>tests different implementations against each other</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_documentation">documentation</h4>
<div class="ulist">
<ul>
<li>
<p>doc</p>
</li>
<li>
<p>@snippet</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_shadow_parent">shadow-parent</h4>
<div class="ulist">
<ul>
<li>
<p>maven stuff</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Currently Supported are:</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_annotation_processing">Annotation Processing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_this">What is this?</h3>
<div class="paragraph">
<p>Annotation-processors run at compile time. They process representations of the %linenums code that is being compiled.
They also can create new Files, including %linenums files, and raise errors or warnings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Featureset 6/10</p>
</li>
<li>
<p>Performance 10/10</p>
</li>
<li>
<p>Correctness 9/10</p>
</li>
<li>
<p>Usability 3/10</p>
</li>
<li>
<p>Maintainability 9/10</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started">Getting started</h3>
<div class="paragraph">
<p>It&#8217;s normal annotation processing with a better API.
The setup is the same.
The differences only start when extending`io.determann.shadow.api.annotation_processing.ShadowProcessor` instead of <code>javax.annotation.processing.AbstractProcessor</code>.
A good starting point for your own processor is <code>AnnotationProcessingContext.getAnnotatedWith(java.lang.String)</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setup">Setup</h3>
<div class="paragraph">
<p>We will create everything you need to get started with your first annotation processor using maven in this setup.</p>
</div>
<div class="sect3">
<h4 id="_1_two_modules">1) Two Modules</h4>
<div class="paragraph">
<p>The annotation processor must be compiled first.
Create two maven modules.
One having the code to process and one containing the annotation processor.</p>
</div>
<div class="listingblock">
<div class="title">processor module</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.determann<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>processor-example<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">processed module</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>io.determann<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>processed-example<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_dependencies">2) Dependencies</h4>
<div class="listingblock">
<div class="title">The processor needs to depend on the <code>shadow-api</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>io.determann<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>shadow<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">And the processed module needs to depend on the processor module</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>io.determann<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>processor-example<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_processor_paths">3) Processor paths</h4>
<div class="listingblock">
<div class="title">The module being processed needs to know the module it&#8217;s processed by</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre>    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;annotationProcessorPaths&gt;</span>
                        <span class="nt">&lt;path&gt;</span>
                            <span class="nt">&lt;groupId&gt;</span>io.determann<span class="nt">&lt;/groupId&gt;</span>
                            <span class="nt">&lt;artifactId&gt;</span>processor-example<span class="nt">&lt;/artifactId&gt;</span>
                            <span class="nt">&lt;version&gt;</span>0.2.0<span class="nt">&lt;/version&gt;</span>
                        <span class="nt">&lt;/path&gt;</span>
                    <span class="nt">&lt;/annotationProcessorPaths&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_disable_annotation_processing">4) Disable annotation processing</h4>
<div class="listingblock">
<div class="title">Disable annotation processing in the processor module, otherwise the annotation processor would be used to process itself</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
</pre></td><td class="code"><pre>    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="err">&lt;</span>%linenums&gt;17<span class="err">&lt;</span>/%linenums&gt;
                    <span class="nt">&lt;target&gt;</span>17<span class="nt">&lt;/target&gt;</span>
                    <span class="c">&lt;!--don't compile the annotation processor using the annotation processor--&gt;</span>
                    <span class="nt">&lt;compilerArgument&gt;</span>-proc:none<span class="nt">&lt;/compilerArgument&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_the_processor_itself">5) The processor itself</h4>
<div class="listingblock">
<div class="title">Extend <code>ShadowProcessor</code> for your own processor and override <code>process()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">io.determann.shadow.api.annotation_processing.AnnotationProcessingContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.determann.shadow.api.annotation_processing.ShadowProcessor</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyProcessor</span> <span class="kd">extends</span> <span class="nc">ShadowProcessor</span>
<span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="kd">final</span> <span class="nc">AnnotationProcessingContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6_register_this_processor">6) Register this processor</h4>
<div class="listingblock">
<div class="title">Create a file in <code>src/main/re%linenumss/META-INF/services/</code> called <code>javax.annotation.processing.Processor</code> and add your qualified path</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="text"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>io.determann.shadow.example.processor.MyProcessor
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_7_annotation">7) Annotation</h4>
<div class="listingblock">
<div class="title">Now create an Annotation to process in the processor module</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MyAnnotation</span> <span class="o">{}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_8_process">8) Process</h4>
<div class="listingblock">
<div class="title">And finally process anything annotated with that annotation</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">io.determann.shadow.api.annotation_processing.AnnotationProcessingContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.determann.shadow.api.annotation_processing.ShadowProcessor</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyProcessor</span> <span class="kd">extends</span> <span class="nc">ShadowProcessor</span>
<span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="kd">final</span> <span class="nc">AnnotationProcessingContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="nc">Shadow</span> <span class="n">shadow</span> <span class="o">:</span> <span class="n">context</span><span class="o">.</span><span class="na">getAnnotatedWith</span><span class="o">(</span><span class="s">"org.example.MyAnnotation"</span><span class="o">).</span><span class="na">all</span><span class="o">())</span> <span class="o">{</span>
      <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_builder_example">Simple Builder Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">An annotation to mark classes</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">BuilderPattern</span> <span class="o">{}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">A Processor creating a simple Builder companion object</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">io.determann.shadow.builder</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">io.determann.shadow.api.annotation_processing.AnnotationProcessingContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.determann.shadow.api.annotation_processing.ShadowProcessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.determann.shadow.api.property.MutableProperty</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">io.determann.shadow.api.shadow.Class</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">lang3</span><span class="o">.</span><span class="na">StringUtils</span><span class="o">.</span><span class="na">capitalize</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">lang3</span><span class="o">.</span><span class="na">StringUtils</span><span class="o">.</span><span class="na">uncapitalize</span><span class="o">;</span>

<span class="cm">/**
 * Builds a companion Builder class for each annotated class
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShadowBuilderProcessor</span> <span class="kd">extends</span> <span class="nc">ShadowProcessor</span>
<span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="kd">final</span> <span class="nc">AnnotationProcessingContext</span> <span class="n">annotationProcessingContext</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="c1">//iterate over every class annotated with the BuilderPattern annotation</span>
      <span class="k">for</span> <span class="o">(</span><span class="nc">Class</span> <span class="n">aClass</span> <span class="o">:</span> <span class="n">annotationProcessingContext</span><span class="o">.</span><span class="na">getAnnotatedWith</span><span class="o">(</span><span class="s">"io.determann.shadow.builder.BuilderPattern"</span><span class="o">).</span><span class="na">classes</span><span class="o">())</span>
      <span class="o">{</span>
         <span class="nc">String</span> <span class="n">toBuildQualifiedName</span> <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="na">getQualifiedName</span><span class="o">();</span>
         <span class="nc">String</span> <span class="n">builderQualifiedName</span> <span class="o">=</span> <span class="n">toBuildQualifiedName</span> <span class="o">+</span> <span class="s">"ShadowBuilder"</span><span class="o">;</span><span class="c1">//qualifiedName of the companion builder class</span>
         <span class="nc">String</span> <span class="n">builderSimpleName</span> <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"ShadowBuilder"</span><span class="o">;</span><span class="c1">//simpleName of the companion builder class</span>
         <span class="nc">String</span> <span class="n">builderVariableName</span> <span class="o">=</span> <span class="n">uncapitalize</span><span class="o">(</span><span class="n">builderSimpleName</span><span class="o">);</span>

         <span class="c1">//create a record holding the code needed to render a property in the builder</span>
         <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BuilderElement</span><span class="o">&gt;</span> <span class="n">builderElements</span> <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="na">getMutableProperties</span><span class="o">()</span>
                                                      <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                                                      <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">property</span> <span class="o">-&gt;</span> <span class="n">renderProperty</span><span class="o">(</span><span class="n">builderSimpleName</span><span class="o">,</span>
                                                                                      <span class="n">builderVariableName</span><span class="o">,</span>
                                                                                      <span class="n">property</span><span class="o">))</span>
                                                      <span class="o">.</span><span class="na">toList</span><span class="o">();</span>

         <span class="c1">//writes the builder</span>
         <span class="n">annotationProcessingContext</span><span class="o">.</span><span class="na">writeAndCompileSourceFile</span><span class="o">(</span><span class="n">builderQualifiedName</span><span class="o">,</span>
                                                               <span class="n">renderBuilder</span><span class="o">(</span><span class="n">aClass</span><span class="o">,</span>
                                                                             <span class="n">toBuildQualifiedName</span><span class="o">,</span>
                                                                             <span class="n">builderSimpleName</span><span class="o">,</span>
                                                                             <span class="n">builderVariableName</span><span class="o">,</span>
                                                                             <span class="n">builderElements</span><span class="o">));</span>
      <span class="o">}</span>
   <span class="o">}</span>

   <span class="cm">/**
    * renders a companion builder class
    */</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="nf">renderBuilder</span><span class="o">(</span><span class="kd">final</span> <span class="nc">Class</span> <span class="n">aClass</span><span class="o">,</span>
                                <span class="kd">final</span> <span class="nc">String</span> <span class="n">toBuildQualifiedName</span><span class="o">,</span>
                                <span class="kd">final</span> <span class="nc">String</span> <span class="n">builderSimpleName</span><span class="o">,</span>
                                <span class="kd">final</span> <span class="nc">String</span> <span class="n">builderVariableName</span><span class="o">,</span>
                                <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">BuilderElement</span><span class="o">&gt;</span> <span class="n">builderElements</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="nc">String</span> <span class="n">fields</span> <span class="o">=</span> <span class="n">builderElements</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                                     <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">BuilderElement:</span><span class="o">:</span><span class="n">field</span><span class="o">)</span>
                                     <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">));</span>

      <span class="nc">String</span> <span class="n">mutators</span> <span class="o">=</span> <span class="n">builderElements</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                                       <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">BuilderElement:</span><span class="o">:</span><span class="n">mutator</span><span class="o">)</span>
                                       <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">));</span>

      <span class="nc">String</span> <span class="n">setterInvocations</span> <span class="o">=</span> <span class="n">builderElements</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                                                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">BuilderElement:</span><span class="o">:</span><span class="n">toBuildSetter</span><span class="o">)</span>
                                                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">"\n\n"</span><span class="o">));</span>
      <span class="k">return</span> <span class="s">"""
            package %1$s;
                  
            public class %2$s{
               %3$s
                  
            %4$s
                  
               public %5$s build() {
                  %5$s %6$s = new %5$s();
                  %7$s
                  return %6$s;
               }
            }
            """</span><span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">aClass</span><span class="o">.</span><span class="na">getPackage</span><span class="o">().</span><span class="na">getQualifiedName</span><span class="o">(),</span>
                          <span class="n">builderSimpleName</span><span class="o">,</span>
                          <span class="n">fields</span><span class="o">,</span>
                          <span class="n">mutators</span><span class="o">,</span>
                          <span class="n">toBuildQualifiedName</span><span class="o">,</span>
                          <span class="n">builderVariableName</span><span class="o">,</span>
                          <span class="n">setterInvocations</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * Creates a {@link BuilderElement} for each property of the annotated pojo
    */</span>
   <span class="kd">private</span> <span class="nc">BuilderElement</span> <span class="nf">renderProperty</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">builderSimpleName</span><span class="o">,</span>
                                         <span class="kd">final</span> <span class="nc">String</span> <span class="n">builderVariableName</span><span class="o">,</span>
                                         <span class="kd">final</span> <span class="nc">MutableProperty</span> <span class="n">property</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="nc">String</span> <span class="n">propertyName</span> <span class="o">=</span> <span class="n">property</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
      <span class="nc">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">property</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
      <span class="nc">String</span> <span class="n">field</span> <span class="o">=</span> <span class="s">"private "</span> <span class="o">+</span> <span class="n">type</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">propertyName</span> <span class="o">+</span> <span class="s">";"</span><span class="o">;</span>

      <span class="nc">String</span> <span class="n">mutator</span> <span class="o">=</span> <span class="s">"""
               public %1$s with%2$s(%3$s %4$s) {
                  this.%4$s = %4$s;
                  return this;
               }
            """</span><span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">builderSimpleName</span><span class="o">,</span>
                          <span class="n">capitalize</span><span class="o">(</span><span class="n">propertyName</span><span class="o">),</span>
                          <span class="n">type</span><span class="o">,</span>
                          <span class="n">propertyName</span><span class="o">);</span>

      <span class="nc">String</span> <span class="n">toBuildSetter</span> <span class="o">=</span> <span class="n">builderVariableName</span> <span class="o">+</span> <span class="s">"."</span> <span class="o">+</span> <span class="n">property</span><span class="o">.</span><span class="na">getSetter</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">propertyName</span> <span class="o">+</span> <span class="s">");"</span><span class="o">;</span>

      <span class="k">return</span> <span class="k">new</span> <span class="nf">BuilderElement</span><span class="o">(</span><span class="n">field</span><span class="o">,</span> <span class="n">mutator</span><span class="o">,</span> <span class="n">toBuildSetter</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="cm">/**
    * Used to render the code needed to render a property in the builder
    *
    * @param field ones rendered will hold the values being used to build the pojo
    * @param mutator ones rendered will set the value of the {@link #field}
    * @param toBuildSetter ones rendered will modify the build pojo
    */</span>
   <span class="kd">private</span> <span class="n">record</span> <span class="nf">BuilderElement</span><span class="o">(</span><span class="nc">String</span> <span class="n">field</span><span class="o">,</span>
                                 <span class="nc">String</span> <span class="n">mutator</span><span class="o">,</span>
                                 <span class="nc">String</span> <span class="n">toBuildSetter</span><span class="o">)</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">For a simple pojo like</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="code"><pre><span class="kn">package</span> <span class="nn">io.determann.shadow.builder</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="nd">@BuilderPattern</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span>
<span class="o">{</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span>
   <span class="o">{</span>
      <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span>
   <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span> <span class="o">==</span> <span class="n">o</span> <span class="o">||</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Customer</span> <span class="n">customer</span> <span class="o">&amp;&amp;</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">getName</span><span class="o">(),</span> <span class="n">customer</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span>
   <span class="o">{</span>
      <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">getName</span><span class="o">());</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span>
   <span class="o">{</span>
      <span class="k">return</span> <span class="s">"Customer{"</span> <span class="o">+</span>
             <span class="s">"name='"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">'\''</span> <span class="o">+</span>
             <span class="sc">'}'</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">This builder would be generated</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomerShadowBuilder</span><span class="o">{</span>
   <span class="kd">private</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">name</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nc">CustomerShadowBuilder</span> <span class="nf">withName</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="n">io</span><span class="o">.</span><span class="na">determann</span><span class="o">.</span><span class="na">shadow</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">Customer</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
     <span class="n">io</span><span class="o">.</span><span class="na">determann</span><span class="o">.</span><span class="na">shadow</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">io</span><span class="o">.</span><span class="na">determann</span><span class="o">.</span><span class="na">shadow</span><span class="o">.</span><span class="na">builder</span><span class="o">.</span><span class="na">Customer</span><span class="o">();</span>
      <span class="n">customer</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">customer</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reflection">reflection</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_this_2">What is this?</h3>
<div class="paragraph">
<p>The most common type of meta-Programming.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
This reflection implementation is still experimental.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Featureset 5/10</p>
</li>
<li>
<p>Performance 3/10</p>
</li>
<li>
<p>Correctness 4/10</p>
</li>
<li>
<p>Usability 10/10</p>
</li>
<li>
<p>Maintainability 4/10</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_getting_started_2">Getting started</h3>
<div class="paragraph">
<p>It&#8217;s as simple as calling the ReflectionAdapter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre> <span class="nc">Class</span> <span class="n">shadow</span> <span class="o">=</span> <span class="nc">ReflectionAdapter</span><span class="o">.</span><span class="na">getShadow</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_lang_model">java.lang.model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_this_3">What is this?</h3>
<div class="paragraph">
<p><code>java.lang.model</code> the the JDKs try at one meta-programming api. its used by
<a href="#_annotation_processing">Annotation Processing</a> and the
<a href="https://docs.oracle.com/javase/9/docs/api/jdk/javadoc/doclet/package-summary.html">new Doclet API</a>.
The Proposal for an implementation based on reflection
<a href="https://openjdk.org/jeps/119">JEP 119</a> was not completed.</p>
</div>
</div>
</div>
</div>
</div>
<script>
;(function () { /*! Asciidoctor Tabs | Copyright (c) 2018-present Dan Allen | MIT License */
  'use strict'

  var config = (document.currentScript || {}).dataset || {}
  var forEach = Array.prototype.forEach

  init(document.querySelectorAll('.tabs'))

  function init (tabsBlocks) {
    if (!tabsBlocks.length) return
    forEach.call(tabsBlocks, function (tabs) {
      var syncIds = tabs.classList.contains('is-sync') ? {} : undefined
      var tablist = tabs.querySelector('.tablist ul')
      tablist.setAttribute('role', 'tablist')
      var start
      forEach.call(tablist.querySelectorAll('li'), function (tab, idx) {
        tab.tabIndex = -1
        tab.setAttribute('role', tab.classList.add('tab') || 'tab')
        var id, anchor, syncId
        if (!(id = tab.id) && (anchor = tab.querySelector('a[id]'))) {
          id = tab.id = anchor.parentNode.removeChild(anchor).id
        }
        var panel = id && tabs.querySelector('.tabpanel[aria-labelledby~="' + id + '"]')
        if (!panel) return idx ? undefined : toggleSelected(tab, true) // invalid state
        syncIds && (((syncId = tab.textContent.trim()) in syncIds) ? (syncId = undefined) : true) &&
        (syncIds[(tab.dataset.syncId = syncId)] = tab)
        idx || (syncIds && (start = { tab: tab, panel: panel })) ? toggleHidden(panel, true) : toggleSelected(tab, true)
        tab.setAttribute('aria-controls', panel.id)
        panel.setAttribute('role', 'tabpanel')
        var onClick = syncId === undefined ? activateTab : activateTabSync
        tab.addEventListener('click', onClick.bind({ tabs: tabs, tab: tab, panel: panel }))
      })
      if (!tabs.closest('.tabpanel')) {
        forEach.call(tabs.querySelectorAll('.tabpanel table.tableblock'), function (table) {
          var container = Object.assign(document.createElement('div'), { className: 'tablecontainer' })
          table.parentNode.insertBefore(container, table).appendChild(table)
        })
      }
      if (start) {
        var syncGroupId
        for (var i = 0, lst = tabs.classList, len = lst.length, className; i !== len; i++) {
          if (!(className = lst.item(i)).startsWith('data-sync-group-id=')) continue
          tabs.dataset.syncGroupId = syncGroupId = lst.remove(className) || className.slice(19).replace(/\u00a0/g, ' ')
          break
        }
        if (syncGroupId === undefined) tabs.dataset.syncGroupId = syncGroupId = Object.keys(syncIds).sort().join('|')
        var preferredSyncId = 'syncStorageKey' in config &&
          window[(config.syncStorageScope || 'local') + 'Storage'].getItem(config.syncStorageKey + '-' + syncGroupId)
        var tab = preferredSyncId && syncIds[preferredSyncId]
        tab && Object.assign(start, { tab: tab, panel: document.getElementById(tab.getAttribute('aria-controls')) })
        toggleSelected(start.tab, true) || toggleHidden(start.panel, false)
      }
    })
    onHashChange()
    toggleClassOnEach(tabsBlocks, 'is-loading', 'remove')
    window.setTimeout(toggleClassOnEach.bind(null, tabsBlocks, 'is-loaded', 'add'), 0)
    window.addEventListener('hashchange', onHashChange)
  }

  function activateTab (e) {
    var tab = this.tab
    var tabs = this.tabs || (this.tabs = tab.closest('.tabs'))
    var panel = this.panel || (this.panel = document.getElementById(tab.getAttribute('aria-controls')))
    querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (el) {
      toggleSelected(el, el === tab)
    })
    querySelectorWithSiblings(tabs, '.tabpanel', 'tabpanel').forEach(function (el) {
      toggleHidden(el, el !== panel)
    })
    if (!this.isSync && 'syncStorageKey' in config && 'syncGroupId' in tabs.dataset) {
      var storageKey = config.syncStorageKey + '-' + tabs.dataset.syncGroupId
      window[(config.syncStorageScope || 'local') + 'Storage'].setItem(storageKey, tab.dataset.syncId)
    }
    if (!e) return
    var loc = window.location
    var hashIdx = loc.hash ? loc.href.indexOf('#') : -1
    if (~hashIdx) window.history.replaceState(null, '', loc.href.slice(0, hashIdx))
    e.preventDefault()
  }

  function activateTabSync (e) {
    activateTab.call(this, e)
    var thisTabs = this.tabs
    var thisTab = this.tab
    var initialY = thisTabs.getBoundingClientRect().y
    forEach.call(document.querySelectorAll('.tabs'), function (tabs) {
      if (tabs === thisTabs || tabs.dataset.syncGroupId !== thisTabs.dataset.syncGroupId) return
      querySelectorWithSiblings(tabs, '.tablist .tab', 'tab').forEach(function (tab) {
        if (tab.dataset.syncId === thisTab.dataset.syncId) activateTab.call({ tabs: tabs, tab: tab, isSync: true })
      })
    })
    var shiftedBy = thisTabs.getBoundingClientRect().y - initialY
    if (shiftedBy && (shiftedBy = Math.round(shiftedBy))) window.scrollBy({ top: shiftedBy, behavior: 'instant' })
  }

  function querySelectorWithSiblings (scope, selector, siblingClass) {
    var el = scope.querySelector(selector)
    if (!el) return []
    var result = [el]
    while ((el = el.nextElementSibling) && el.classList.contains(siblingClass)) result.push(el)
    return result
  }

  function toggleClassOnEach (elements, className, method) {
    forEach.call(elements, function (el) {
      el.classList[method](className)
    })
  }

  function toggleHidden (el, state) {
    el.classList[(el.hidden = state) ? 'add' : 'remove']('is-hidden')
  }

  function toggleSelected (el, state) {
    el.setAttribute('aria-selected', '' + state)
    el.classList[state ? 'add' : 'remove']('is-selected')
    el.tabIndex = state ? 0 : -1
  }

  function onHashChange () {
    var id = window.location.hash.slice(1)
    if (!id) return
    var tab = document.getElementById(~id.indexOf('%') ? decodeURIComponent(id) : id)
    if (!(tab && tab.classList.contains('tab'))) return
    'syncId' in tab.dataset ? activateTabSync.call({ tab: tab }) : activateTab.call({ tab: tab })
  }
})()
</script>
</body>
</html>